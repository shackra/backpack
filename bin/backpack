#!/usr/bin/env sh

set -eu

ACTION="${1:-}"

if [ -z "$ACTION" ]; then
    echo "❌ Error: missing argument" >&2
    echo "Usage: $0 <action>" >&2
    exit 1
fi

# Buscar directorio de configuración
if [ -d "$HOME/.emacs.d" ]; then
    INIT_DIR="$HOME/.emacs.d"
elif [ -d "$XDG_CONFIG_HOME/emacs" ]; then
    INIT_DIR="$XDG_CONFIG_HOME/emacs"
else
    echo "❌ Error: Emacs configuration directory not found ($HOME/.emacs.d or $XDG_CONFIG_HOME/emacs)" >&2
    exit 1
fi

if [ "$ACTION" = "ensure" ]; then
    echo "✅ Running Emacs in batch mode..."
    emacs -nw --eval '(load (expand-file-name "ensure.el" backpack-emacs-dir))'
    exit $?
else
    echo "❌ Error: unknown action '$ACTION'" >&2
    echo "available actions: ensure" >&2
    exit 1
fi

